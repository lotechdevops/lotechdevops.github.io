"use strict";(self.webpackChunkdevopsr_66=self.webpackChunkdevopsr_66||[]).push([[1833],{341:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"kubernetes/updatesdeployments/rollingupdaterecreate","title":"Estrat\xe9gias de Atualiza\xe7\xe3o de Deployments no Kubernetes.","description":"Guia de pr\xe1tico de atualiza\xe7\xe3o de deployments usando as estrat\xe9gias RollingUpdate e Recreate.","source":"@site/docs/kubernetes/updatesdeployments/rollingupdate-recreate.md","sourceDirName":"kubernetes/updatesdeployments","slug":"/kubernetes/updatesdeployments/rollingupdaterecreate","permalink":"/docs/kubernetes/updatesdeployments/rollingupdaterecreate","draft":false,"unlisted":false,"editUrl":"https://github.com/lotechdevops/lotechdevops.github.io/tree/main/docs/kubernetes/updatesdeployments/rollingupdate-recreate.md","tags":[],"version":"current","frontMatter":{"id":"rollingupdaterecreate","title":"Estrat\xe9gias de Atualiza\xe7\xe3o de Deployments no Kubernetes.","sidebar_label":"Estrat\xe9gias RollingUpdate e Recreate","description":"Guia de pr\xe1tico de atualiza\xe7\xe3o de deployments usando as estrat\xe9gias RollingUpdate e Recreate.","image":"/img/strategyupdates-deployments-social-card.png"},"sidebar":"tutorialSidebar","previous":{"title":"Estrat\xe9gias de Atualiza\xe7\xe3o de Deployments","permalink":"/docs/category/estrat\xe9gias-de-atualiza\xe7\xe3o-de-deployments"},"next":{"title":"intro","permalink":"/docs/kubernetes/intro"}}');var r=s(4848),o=s(8453);const t={id:"rollingupdaterecreate",title:"Estrat\xe9gias de Atualiza\xe7\xe3o de Deployments no Kubernetes.",sidebar_label:"Estrat\xe9gias RollingUpdate e Recreate",description:"Guia de pr\xe1tico de atualiza\xe7\xe3o de deployments usando as estrat\xe9gias RollingUpdate e Recreate.",image:"/img/strategyupdates-deployments-social-card.png"},i=void 0,l={},d=[{value:"Estrat\xe9gia RollingUpdate",id:"estrat\xe9gia-rollingupdate",level:2},{value:"\ud83d\udd27 Exemplo de Configura\xe7\xe3o",id:"-exemplo-de-configura\xe7\xe3o",level:3},{value:"Explica\xe7\xe3o dos campos (type, maxSurge, maxUnavailable)",id:"explica\xe7\xe3o-dos-campos-type-maxsurge-maxunavailable",level:3},{value:"Estrat\xe9gia Recreate",id:"estrat\xe9gia-recreate",level:2},{value:"\ud83d\udd27 Exemplo de Configura\xe7\xe3o",id:"-exemplo-de-configura\xe7\xe3o-1",level:3},{value:"Comandos \xfateis",id:"comandos-\xfateis",level:3}];function c(e){const a={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.p,{children:["Quando criamos um ",(0,r.jsx)(a.strong,{children:"Deployment"})," no Kubernetes, n\xe3o precisamos necessariamente definir uma estrat\xe9gia de atualiza\xe7\xe3o. Nesse caso, o Kubernetes aplica automaticamente a estrat\xe9gia padr\xe3o: ",(0,r.jsx)(a.strong,{children:"RollingUpdate"}),"."]}),"\n",(0,r.jsxs)(a.p,{children:["Mas voc\xea sabia que o Kubernetes oferece ",(0,r.jsx)(a.strong,{children:"duas estrat\xe9gias principais"})," para atualizar seus Deployments?"]}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.strong,{children:"RollingUpdate"})}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.strong,{children:"Recreate"})}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:"Essas estrat\xe9gias definem como os Pods de um Deployment ser\xe3o atualizados quando h\xe1 altera\xe7\xf5es na defini\xe7\xe3o do recurso \u2014 como uma nova imagem de container ou mudan\xe7as nas configura\xe7\xf5es."}),"\n",(0,r.jsx)(a.h2,{id:"estrat\xe9gia-rollingupdate",children:"Estrat\xe9gia RollingUpdate"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"RollingUpdate",src:s(842).A+"",width:"787",height:"503"})}),"\n",(0,r.jsxs)(a.p,{children:["A estrat\xe9gia ",(0,r.jsx)(a.strong,{children:"RollingUpdate"})," \xe9 a ",(0,r.jsx)(a.strong,{children:"padr\xe3o"})," utilizada pelo Kubernetes para atualizar os Pods de um Deployment de forma ",(0,r.jsx)(a.strong,{children:"gradual"})," \u2014 ou seja, ela atualiza um Pod por vez ou em pequenos grupos, sem interromper todo o servi\xe7o de uma s\xf3 vez."]}),"\n",(0,r.jsxs)(a.p,{children:["Essa abordagem \xe9 ideal para garantir ",(0,r.jsx)(a.strong,{children:"alta disponibilidade"})," durante atualiza\xe7\xf5es, principalmente em ambientes de produ\xe7\xe3o."]}),"\n",(0,r.jsx)(a.hr,{}),"\n",(0,r.jsx)(a.h3,{id:"-exemplo-de-configura\xe7\xe3o",children:"\ud83d\udd27 Exemplo de Configura\xe7\xe3o"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: webserver\nspec: \n  replicas: 10\n  selector: \n    matchLabels: \n      app: webserver\n  strategy: \n    type: RollingUpdate\n    rollingUpdate: \n      maxSurge: 5\n      maxUnavailable: 5\n  template:\n    metadata:\n      labels:\n        app: webserver\n    spec:\n      containers:\n        - name: nginx\n          image: nginx:latest\n"})}),"\n",(0,r.jsx)(a.h3,{id:"explica\xe7\xe3o-dos-campos-type-maxsurge-maxunavailable",children:"Explica\xe7\xe3o dos campos (type, maxSurge, maxUnavailable)"}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"type:"})," - Define o tipo de estrat\xe9gia de atualiza\xe7\xe3o utilizada, neste caso, RollingUpdate."]}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"maxSurge: 5"})," - Durante o processo de atualiza\xe7\xe3o, o Kubernetes ",(0,r.jsx)(a.strong,{children:"pode criar at\xe9 5 Pods adicionais acima do n\xfamero especificado em r\xe9plicas"}),". Isso significa que, temporariamente, ",(0,r.jsx)(a.strong,{children:"podemos ter at\xe9 15 Pods em execu\xe7\xe3o (10 r\xe9plicas + 5 pods adicionais)"})," para acelerar a atualiza\xe7\xe3o sem aguardar os pods antigos sejam completamente encerrados."]}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"maxUnavailable: 5"})," - Define que, durante a atualiza\xe7\xe3o, ",(0,r.jsx)(a.strong,{children:"at\xe9 5 pods podem estar indispon\xedveis simultaneamente"}),". Isso significa que o Kubernetes ",(0,r.jsx)(a.strong,{children:"pode encerrar at\xe9 metade dos pods antigos enquanto cria os novos"}),", mantendo um balan\xe7o entre disponibilidade e velocidade."]}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Abaixo um exemplo de quando aplicamos uma atualiza\xe7\xe3o do Deployment utilizando a estrat\xe9gia RollingUpdate."}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Exemplo RollingUpdate",src:s(7131).A+"",width:"1100",height:"384"})}),"\n",(0,r.jsx)(a.h2,{id:"estrat\xe9gia-recreate",children:"Estrat\xe9gia Recreate"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"RollingUpdate",src:s(3470).A+"",width:"661",height:"476"})}),"\n",(0,r.jsxs)(a.p,{children:["Ao contr\xe1rio da RollingUpdate, a ",(0,r.jsx)(a.strong,{children:"Estrat\xe9gia Recreate"})," interrompe todos os Pods atuais antes de iniciar novos. Isso significa que haver\xe1 um per\xedodo em que nenhum Pod estar\xe1 dispon\xedvel."]}),"\n",(0,r.jsx)(a.p,{children:"Essa abordagem pode ser \xfatil quando:"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"O novo pod n\xe3o pode coexistir com os antigos (por exemplo, mudan\xe7a incompat\xedvel no banco de dados)."}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Voc\xea quer garantir que todos os recursos antigos sejam encerrados antes da nova vers\xe3o subir."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"-exemplo-de-configura\xe7\xe3o-1",children:"\ud83d\udd27 Exemplo de Configura\xe7\xe3o"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n      app: webserver\n  name: webserver\n  namespace: webserver\nspec:\n  replicas: 12\n  selector:\n    matchLabels:\n      app: webserver\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: webserver\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.15.0\n        \n"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["A estrat\xe9gia Recreate possui apenas a configura\xe7\xe3o do campo ",(0,r.jsx)(a.strong,{children:"type"})," ,pois ele remove todos os Pods antes de criar os novos."]}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Abaixo um exemplo de quando aplicamos uma atualiza\xe7\xe3o do Deployment utilizando a estrat\xe9gia Recreate."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Exemplo Recreate",src:s(5587).A+"",width:"1100",height:"240"})}),"\n",(0,r.jsx)(a.h3,{id:"comandos-\xfateis",children:"Comandos \xfateis"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Acompanha o processo de atualiza\xe7\xe3o, mostrando se a atualiza\xe7\xe3o falhou ou se deu sucesso."}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"kubectl rollout status deployment webserver -n webserver\n"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Comandos para fazer rollback de uma vers\xe3o anterior ou fazer rollback para uma vers\xe3o espec\xedfica."}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"kubectl rollout undo deployment webserver -n webserver\n"})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"kubectl rollout undo deployment webserver -n webserver --to-revision=1\n"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Comando para visualizar o hist\xf3rico de atualiza\xe7\xf5es"}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"kubectl rollout history deployment webserver -n webserver\n"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Pausar uma atualiza\xe7\xe3o em andamento"}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"kubectl rollout pause deployment webserver -n webserver\n"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Retomar uma atualiza\xe7\xe3o pausada:"}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"kubectl rollout resume deployment webserver -n webserver\n"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Reiniciar um Deployment:"}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"kubectl rollout restart deployment webserver -n webserver\n"})}),"\n",(0,r.jsx)(a.p,{children:"\ud83d\udd17 Todos os arquivos utilizados neste artigo est\xe3o dispon\xedveis em:"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.a,{href:"https://github.com/lotechdevops/config-examples/tree/main/deployments-updates",children:"https://github.com/lotechdevops/deployments-updates"})})]})}function p(e={}){const{wrapper:a}={...(0,o.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},842:(e,a,s)=>{s.d(a,{A:()=>n});const n=s.p+"assets/images/rolling-update-b9a43e6799429ec1849f6469e132d836.png"},3470:(e,a,s)=>{s.d(a,{A:()=>n});const n=s.p+"assets/images/recreate-96b6e293cdd576490f4b81254c583228.png"},5587:(e,a,s)=>{s.d(a,{A:()=>n});const n=s.p+"assets/images/exemplo-recreate-cb74915242152ff6d0164baf315fe93b.png"},7131:(e,a,s)=>{s.d(a,{A:()=>n});const n=s.p+"assets/images/exemplo-rolling-update-a042e6a1e6d5795b420a32f521d7d8c3.png"},8453:(e,a,s)=>{s.d(a,{R:()=>t,x:()=>i});var n=s(6540);const r={},o=n.createContext(r);function t(e){const a=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),n.createElement(o.Provider,{value:a},e.children)}}}]);